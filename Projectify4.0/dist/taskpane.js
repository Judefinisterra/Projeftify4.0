/*! For license information please see taskpane.js.LICENSE.txt */
!function(){"use strict";var e={58394:function(e,t,r){e.exports=r.p+"1fda685b81e1123773f6.css"},98362:function(e,t,r){e.exports=r.p+"assets/logo-filled.png"}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.m=e,r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e}(),r.b=document.baseURI||self.location.href,function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function n(t,r,n){return(r=function(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return a(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw s}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(){s=function(){return r};var t,r={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,s=Object.create(o.prototype),i=new j(n||[]);return a(s,"_invoke",{value:S(e,r,i)}),s}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var h="suspendedStart",y="suspendedYield",g="executing",m="completed",v={};function b(){}function x(){}function w(){}var E={};p(E,c,(function(){return this}));var P=Object.getPrototypeOf,I=P&&P(P(T([])));I&&I!==n&&o.call(I,c)&&(E=I);var A=w.prototype=b.prototype=Object.create(E);function O(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function k(t,r){function n(a,s,i,c){var u=d(t[a],t,s);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==e(p)&&o.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):r.resolve(p).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}var s;a(this,"_invoke",{value:function(e,t){function o(){return new r((function(r,o){n(e,t,r,o)}))}return s=s?s.then(o,o):o()}})}function S(e,r,n){var o=h;return function(a,s){if(o===g)throw Error("Generator is already running");if(o===m){if("throw"===a)throw s;return{value:t,done:!0}}for(n.method=a,n.arg=s;;){var i=n.delegate;if(i){var c=N(i,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=g;var u=d(e,r,n);if("normal"===u.type){if(o=n.done?m:y,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=m,n.method="throw",n.arg=u.arg)}}}function N(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var a=d(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var s=a.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function T(r){if(r||""===r){var n=r[c];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var a=-1,s=function e(){for(;++a<r.length;)if(o.call(r,a))return e.value=r[a],e.done=!1,e;return e.value=t,e.done=!0,e};return s.next=s}}throw new TypeError(e(r)+" is not iterable")}return x.prototype=w,a(A,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:x,configurable:!0}),x.displayName=p(w,l,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,l,"GeneratorFunction")),e.prototype=Object.create(A),e},r.awrap=function(e){return{__await:e}},O(k.prototype),p(k.prototype,u,(function(){return this})),r.AsyncIterator=k,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var s=new k(f(e,t,n,o),a);return r.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},O(A),p(A,l,"Generator"),p(A,c,(function(){return this})),p(A,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=T,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return i.type="throw",i.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],i=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=o.call(s,"catchLoc"),u=o.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;C(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:T(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},r}function i(e,t,r,n,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){i(a,n,o,s,c,"next",e)}function c(e){i(a,n,o,s,c,"throw",e)}s(void 0)}))}}var u=(performance.now(),{OPENAI_API_KEY:"",PINECONE_API_KEY:""});function l(){return(l=c(s().mark((function e(){var t,r,n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Initializing API keys..."),e.prev=2,e.next=5,fetch("https://localhost:3002/config.js");case 5:if(!(t=e.sent).ok){e.next=14;break}return e.next=9,t.text();case 9:r=e.sent,n=r.match(/OPENAI_API_KEY\s*=\s*["']([^"']+)["']/),o=r.match(/PINECONE_API_KEY\s*=\s*["']([^"']+)["']/),n&&n[1]&&(u.OPENAI_API_KEY=n[1],console.log("OpenAI API key loaded from config.js")),o&&o[1]&&(u.PINECONE_API_KEY=o[1],console.log("Pinecone API key loaded from config.js"));case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.warn("Could not load config.js, will use empty API keys:",e.t0);case 19:return console.log("OPENAI_API_KEY:",u.OPENAI_API_KEY?"".concat(u.OPENAI_API_KEY.substring(0,3),"...").concat(u.OPENAI_API_KEY.substring(u.OPENAI_API_KEY.length-3)):"Not found"),console.log("PINECONE_API_KEY:",u.PINECONE_API_KEY?"".concat(u.PINECONE_API_KEY.substring(0,3),"...").concat(u.PINECONE_API_KEY.substring(u.PINECONE_API_KEY.length-3)):"Not found"),e.abrupt("return",u.OPENAI_API_KEY&&u.PINECONE_API_KEY);case 24:return e.prev=24,e.t1=e.catch(0),console.error("Error initializing API keys:",e.t1),e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,null,[[0,24],[2,16]])})))).apply(this,arguments)}var p="gpt-4o",f=[];function d(e){try{localStorage.setItem("conversationHistory",JSON.stringify(e)),console.log("Conversation history saved to localStorage")}catch(e){console.error("Error saving conversation history:",e)}}function h(){try{var e=localStorage.getItem("conversationHistory");if(e){console.log("Loaded conversation history from localStorage");var t=JSON.parse(e);return Array.isArray(t)?t:(console.error("Invalid history format, expected array"),[])}return console.log("No conversation history found in localStorage"),[]}catch(e){return console.error("Error loading conversation history:",e),[]}}function y(e){return g.apply(this,arguments)}function g(){return g=c(s().mark((function e(t){var r,n,o,a,i,c=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:p,n=c.length>2&&void 0!==c[2]?c[2]:.7,e.prev=2,console.log("Calling OpenAI API with model: ".concat(r)),u.OPENAI_API_KEY){e.next=6;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 6:return e.next=8,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u.OPENAI_API_KEY)},body:JSON.stringify({model:r,messages:t,temperature:n})});case 8:if((o=e.sent).ok){e.next=15;break}return e.next=12,o.json().catch((function(){return null}));case 12:throw a=e.sent,console.error("OpenAI API error response:",a),new Error("OpenAI API error: ".concat(o.status," ").concat(o.statusText));case 15:return e.next=17,o.json();case 17:return i=e.sent,console.log("OpenAI API response received"),e.abrupt("return",i.choices[0].message.content);case 22:throw e.prev=22,e.t0=e.catch(2),console.error("Error calling OpenAI API:",e.t0),e.t0;case 26:case"end":return e.stop()}}),e,null,[[2,22]])}))),g.apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=c(s().mark((function e(t){var r,n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Creating embedding for text"),u.OPENAI_API_KEY){e.next=4;break}throw new Error("OpenAI API key not found. Please check your API keys.");case 4:return e.next=6,fetch("https://api.openai.com/v1/embeddings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(u.OPENAI_API_KEY)},body:JSON.stringify({model:"text-embedding-3-large",input:t})});case 6:if((r=e.sent).ok){e.next=13;break}return e.next=10,r.json().catch((function(){return null}));case 10:throw n=e.sent,console.error("OpenAI Embeddings API error response:",n),new Error("OpenAI Embeddings API error: ".concat(r.status," ").concat(r.statusText));case 13:return e.next=15,r.json();case 15:return o=e.sent,console.log("OpenAI Embeddings API response received"),e.abrupt("return",o.data[0].embedding);case 20:throw e.prev=20,e.t0=e.catch(0),console.error("Error creating embedding:",e.t0),e.t0;case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}function b(e){return x.apply(this,arguments)}function x(){return(x=c(s().mark((function e(t){var r,n,o,a,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=["https://localhost:3002/prompts/".concat(t,".txt"),"https://localhost:3002/assets/prompts/".concat(t,".txt")],n=null,o=0,a=r;case 4:if(!(o<a.length)){e.next=22;break}return i=a[o],console.log("Attempting to load prompt from: ".concat(i)),e.prev=7,e.next=10,fetch(i);case 10:if(!(n=e.sent).ok){e.next=14;break}return console.log("Successfully loaded prompt from: ".concat(i)),e.abrupt("break",22);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.log("Path ".concat(i," failed: ").concat(e.t0.message));case 19:o++,e.next=4;break;case 22:if(n&&n.ok){e.next=30;break}if(console.log("All paths failed, using fallback for: ".concat(t)),!(c={Structure_System:"You are an AI assistant specialized in analyzing user queries and breaking them down into search queries for retrieving relevant information from specialized databases. Your task is to generate multiple search queries that will help find the most relevant information for the user's request.\n\nWhen given a user query, create 2-5 different search queries that explore different aspects of the question. These queries should be returned as an array of strings.",Followup_System:"You are an AI assistant helping with follow-up questions related to business analysis. Use the conversation history, training data, and context provided to generate a comprehensive and relevant response.",main:"You are an AI assistant helping to analyze and respond to business queries. Use the relevant context and training data provided to generate helpful responses.","test-prompt":"This is a test prompt file used to verify that the prompt loading system is working correctly.",Validation_System:"You are a validation assistant that checks and corrects responses to business analysis queries. Your task is to carefully analyze the initial response and validation results, then provide an improved version that addresses any issues found.",Validation_Main:"This is the main validation prompt. Your task is to validate the generated response against the following criteria.",Encoder_System:"You are an AI assistant specialized in encoding client requests for financial modeling.",Encoder_Main:"Convert the client request into appropriate response format."}[t])){e.next=29;break}return console.log("Using fallback prompt for: ".concat(t)),e.abrupt("return",c);case 29:throw new Error("Failed to load prompt: ".concat(t," (Could not find file in any location)"));case 30:return e.next=32,n.text();case 32:return e.abrupt("return",e.sent);case 35:return e.prev=35,e.t1=e.catch(0),console.error("Error loading prompt ".concat(t,":"),e.t1),e.abrupt("return",null);case 39:case"end":return e.stop()}}),e,null,[[0,35],[7,16]])})))).apply(this,arguments)}var w=function(){var e=c(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(t);case 3:if(r=e.sent){e.next=6;break}throw new Error('Prompt key "'.concat(t,'" not found'));case 6:return e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Error getting prompt for key ".concat(t,":"),e.t0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}();function E(e){return P.apply(this,arguments)}function P(){return(P=c(s().mark((function e(t){var r,n,o,a,i,c,l,p,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userInput,n=t.systemPrompt,o=t.model,a=t.temperature,i=t.history,c=void 0===i?[]:i,console.log("API Key being used:",u.OPENAI_API_KEY?"".concat(u.OPENAI_API_KEY.substring(0,3),"..."):"None"),l=[{role:"system",content:n}],c.length>0&&c.forEach((function(e){l.push({role:"human"===e[0]?"user":"assistant",content:e[1]})})),l.push({role:"user",content:r}),e.prev=5,e.next=8,y(l,o,a);case 8:if(p=e.sent,e.prev=9,f=JSON.parse(p),!Array.isArray(f)){e.next=13;break}return e.abrupt("return",f);case 13:return e.abrupt("return",p.split("\n").filter((function(e){return e.trim()})));case 16:return e.prev=16,e.t0=e.catch(9),e.abrupt("return",p.split("\n").filter((function(e){return e.trim()})));case 19:e.next=25;break;case 21:throw e.prev=21,e.t1=e.catch(5),console.error("Error in processPrompt:",e.t1),e.t1;case 25:case"end":return e.stop()}}),e,null,[[5,21],[9,16]])})))).apply(this,arguments)}function I(e){return A.apply(this,arguments)}function A(){return(A=c(s().mark((function e(t){var n,o,a,i,c,l,p,f,d,h,y,g,v,b;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryPrompt,t.indexName,o=t.numResults,a=void 0===o?10:o,i=t.similarityThreshold,c=void 0===i?null:i,e.prev=1,console.log("Generating embeddings for query:",n),e.next=5,m(n);case 5:return l=e.sent,console.log("Embeddings generated successfully"),p="".concat("https://codes-zmg9zog.svc.aped-4627-b74a.pinecone.io","/query"),console.log("Making Pinecone API request to:",p),f=u.PINECONE_API_KEY,e.next=12,fetch(p,{method:"POST",headers:{"api-key":f,"Content-Type":"application/json"},body:JSON.stringify({vector:l,topK:a,includeMetadata:!0,namespace:"ns1"})});case 12:if((d=e.sent).ok){e.next=19;break}return e.next=16,d.text();case 16:throw h=e.sent,console.error("Pinecone API error details:",{status:d.status,statusText:d.statusText,error:h}),new Error("Pinecone API error: ".concat(d.status," ").concat(d.statusText," - ").concat(h));case 19:return e.next=21,d.json();case 21:return y=e.sent,console.log("Pinecone API response received"),g=y.matches||[],null!==c&&(g=g.filter((function(e){return e.score>=c}))),g=(g=g.slice(0,a)).map((function(e){try{return e.metadata&&e.metadata.text?r(r({},e),{},{text:e.metadata.text}):e}catch(t){return console.error("Error processing match:",t),e}})),v=g.map((function(e,t){return"Match ".concat(t+1," (score: ").concat(e.score.toFixed(4),"): ").concat(e.text||JSON.stringify(e.metadata))})).join("\n"),console.log(v),b=g.map((function(e){return O(e)})),e.abrupt("return",b.filter((function(e){return""!==e})));case 32:throw e.prev=32,e.t0=e.catch(1),console.error("Error during vector database query:",e.t0),e.t0;case 36:case"end":return e.stop()}}),e,null,[[1,32]])})))).apply(this,arguments)}function O(e){try{var t="string"==typeof e?JSON.parse(e):e;if(Array.isArray(t)){var r,n=o(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a.metadata&&a.metadata.text)return a.metadata.text}}catch(e){n.e(e)}finally{n.f()}throw new Error("No text field found in the JSON array")}if(t.metadata&&t.metadata.text)return t.metadata.text;throw new Error("Invalid JSON structure: missing metadata.text field")}catch(e){return console.error("Error processing JSON: ".concat(e.message)),""}}function k(e){if(arguments.length>1&&void 0!==arguments[1]&&!arguments[1]){var t=JSON.stringify(e);return(t=t.replace(/"values":\s*\[\],\s*"metadata":/g,"")).replace(/{/g,"\\u007B").replace(/}/g,"\\u007D")}return Array.isArray(e)?e.map((function(e){if(e.metadata&&e.metadata.text){var t=e.metadata.text.replace(/~/g,",").split(";"),r="";return t.length>=1&&(r+=t[0].trim()),t.length>=2&&(r+="\n"+t[1].trim()),t.length>=3&&(r+="\n"+t[2].trim()),e.score&&(r+="\nSimilarity Score: ".concat(e.score.toFixed(4))),r}return JSON.stringify(e).replace(/~/g,",")})).join("\n\n"):JSON.stringify(e,null,2).replace(/~/g,",").replace(/{/g,"\\u007B").replace(/}/g,"\\u007D")}function S(e){return N.apply(this,arguments)}function N(){return(N=c(s().mark((function e(t){var r,n,o,a,i,c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Processing follow-up question. Loading conversation history..."),!((f=h()).length>0)){e.next=36;break}return console.log("Processing follow-up question:",t),console.log("Loaded conversation history:",JSON.stringify(f,null,2)),e.next=7,w("Followup_System");case 7:return r=e.sent,e.next=10,w("main");case 10:return n=e.sent,e.next=13,I({queryPrompt:t,similarityThreshold:.4,indexName:"call2trainingdata",numResults:3});case 13:return o=e.sent,e.next=16,I({queryPrompt:t+o,similarityThreshold:.3,indexName:"call2context",numResults:5});case 16:return a=e.sent,e.next=19,I({queryPrompt:t+o,similarityThreshold:.3,indexName:"call1context",numResults:5});case 19:return i=e.sent,e.next=22,I({queryPrompt:t+o+i,indexName:"codes",numResults:10,similarityThreshold:.1});case 22:return c=e.sent,u="Client request: "+t+"\nMain Prompt: "+n+"\nTraining Data: "+k(o).replace(/~/g,",")+"\nCode choosing context: "+k(i)+"\nCode editing Context: "+k(a)+"\nCode descriptions: "+k(c),e.next=26,E({userInput:u,systemPrompt:r,model:p,temperature:1,history:f});case 26:return l=e.sent,f.push(["human",t]),f.push(["assistant",l.join("\n")]),d(f),console.log("Updated conversation history:",JSON.stringify(f,null,2)),Y(t,r,n,a,i,o,c,l),R(t,l),e.abrupt("return",l);case 36:return console.log("No conversation history found. Treating as initial question."),e.abrupt("return",j(t));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){return C.apply(this,arguments)}function C(){return C=c(s().mark((function e(t){var r,n=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]&&n[1],e.prev=1,!r){e.next=8;break}return e.next=5,S(t);case 5:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,j(t);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(1),console.error("Error in conversation handling:",e.t0),e.abrupt("return",["Error processing your request: "+e.t0.message]);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),C.apply(this,arguments)}function j(e){return T.apply(this,arguments)}function T(){return(T=c(s().mark((function e(t){var r,n,o,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Processing initial question:",t),e.next=3,w("Encoder_System");case 3:return r=e.sent,e.next=6,w("Encoder_Main");case 6:return n=e.sent,o="Client request: "+t+"\nMain Prompt: "+n,e.next=10,E({userInput:o,systemPrompt:r,model:p,temperature:1});case 10:return a=e.sent,d(f=[["human",t],["assistant",a.join("\n")]]),Y(t,r,n,[],[],[],[],a),R(t,a),e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return L.apply(this,arguments)}function L(){return(L=c(s().mark((function e(t){var r,n,a,i,c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Processing structured database queries:",t),e.prev=1,console.log("Getting structure system prompt"),e.next=5,w("Structure_System");case 5:if(r=e.sent){e.next=8;break}throw new Error("Failed to load structure system prompt");case 8:return console.log("Got system prompt, processing query strings"),e.next=11,E({userInput:t,systemPrompt:r,model:p,temperature:1});case 11:if((n=e.sent)&&Array.isArray(n)){e.next=14;break}throw new Error("Failed to get valid query strings");case 14:console.log("Got query strings:",n),a=[],i=o(n),e.prev=17,i.s();case 19:if((c=i.n()).done){e.next=47;break}return u=c.value,console.log("Processing query:",u),e.prev=22,e.t0=u,e.next=26,I({queryPrompt:u,similarityThreshold:.4,indexName:"call2trainingdata",numResults:3});case 26:return e.t1=e.sent,e.next=29,I({queryPrompt:u,similarityThreshold:.2,indexName:"call2context",numResults:5});case 29:return e.t2=e.sent,e.next=32,I({queryPrompt:u,similarityThreshold:.2,indexName:"call1context",numResults:5});case 32:return e.t3=e.sent,e.next=35,I({queryPrompt:u,indexName:"codes",numResults:3,similarityThreshold:.1});case 35:e.t4=e.sent,l={query:e.t0,trainingData:e.t1,call2Context:e.t2,call1Context:e.t3,codeOptions:e.t4},a.push(l),console.log("Successfully processed query:",u),e.next=45;break;case 41:return e.prev=41,e.t5=e.catch(22),console.error('Error processing query "'.concat(u,'":'),e.t5),e.abrupt("continue",45);case 45:e.next=19;break;case 47:e.next=52;break;case 49:e.prev=49,e.t6=e.catch(17),i.e(e.t6);case 52:return e.prev=52,i.f(),e.finish(52);case 55:if(0!==a.length){e.next=57;break}throw new Error("No valid results were obtained from any queries");case 57:return e.abrupt("return",a);case 60:throw e.prev=60,e.t7=e.catch(1),console.error("Error in structureDatabasequeries:",e.t7),e.t7;case 64:case"end":return e.stop()}}),e,null,[[1,60],[17,49,52,55],[22,41]])})))).apply(this,arguments)}function Y(e,t,r,n,o,a,s,i,c,u,l){try{var p={clientRequest:e,systemPrompt:t,mainPrompt:r,validationSystemPrompt:n,validationMainPrompt:o,validationResults:a,call2context:s,call1context:i,trainingdataCall2:c,codeOptions:u,outputArray2:l};localStorage.setItem("promptAnalysis",JSON.stringify(p)),console.log("Prompt analysis saved to localStorage")}catch(e){console.error("Error saving prompt analysis:",e)}}function R(e,t){try{var r=function(e){return e?e.toString().replace(/\r?\n|\r/g," ").trim():""},n={prompt:r(e),response:r(JSON.stringify(t))};localStorage.setItem("trainingData",JSON.stringify(n)),console.log("Training data saved to localStorage")}catch(e){console.error("Error saving training data:",e)}}function D(){return K.apply(this,arguments)}function K(){return(K=c(s().mark((function e(){var t,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=localStorage.getItem("promptAnalysis")){e.next=4;break}return e.abrupt("return","No validation data available");case 4:if((r=JSON.parse(t)).outputArray2&&Array.isArray(r.outputArray2)){e.next=7;break}return e.abrupt("return","Invalid response format");case 7:return e.abrupt("return","Validation successful - no errors found");case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error during validation:",e.t0),e.abrupt("return","Validation failed: "+e.t0.message);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function F(e,t,r){return J.apply(this,arguments)}function J(){return(J=c(s().mark((function e(t,r,n){var o,a,i,c,u,l,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h(),o=localStorage.getItem("trainingData")||"",a=localStorage.getItem("codeDescriptions")||"",i=localStorage.getItem("lastCallContext")||"",e.next=7,w("Validation_System");case 7:return c=e.sent,e.next=10,w("Validation_Main");case 10:if(u=e.sent,c){e.next=13;break}throw new Error("Failed to load validation system prompt");case 13:return l=Array.isArray(r)?r.join("\n"):String(r),f="Main Prompt: "+u+"\n\nOriginal User Input: "+t+"\n\nInitial Response: "+l+"\n\nValidation Results: "+n+"\n\nTraining Data: "+o+"\n\nCode Descriptions: "+a+"\n\nContext from Last Call: "+i,console.log("====== VALIDATION CORRECTION INPUT ======"),console.log(f.substring(0,500)+"...(truncated)"),console.log("========================================="),e.next=18,E({userInput:f,systemPrompt:c,model:p,temperature:.7});case 18:return d=e.sent,s="C:\\Users\\joeor\\Dropbox\\B - Freelance\\C_Projectify\\VanPC\\Training Data\\Main Script Training and Context Data\\validation_correction_output.txt",y=Array.isArray(d)?d.join("\n"):d,console.log("Mock writeFileSync called with path: ".concat(s)),console.log("Content would be written to ".concat(s,":"),y.substring(0,100)+"..."),console.log("Validation correction saved to ".concat("C:\\Users\\joeor\\Dropbox\\B - Freelance\\C_Projectify\\VanPC\\Training Data\\Main Script Training and Context Data\\validation_correction_output.txt")),e.abrupt("return",d);case 25:return e.prev=25,e.t0=e.catch(0),console.error("Error in validation correction:",e.t0),console.error(e.t0.stack),e.abrupt("return",["Error during validation correction: "+e.t0.message]);case 30:case"end":return e.stop()}var s,y}),e,null,[[0,25]])})))).apply(this,arguments)}function M(e){var t=document.createElement("div");t.style.color="red",t.style.padding="10px",t.style.margin="10px",t.style.border="1px solid red",t.style.borderRadius="4px",t.textContent="Error: ".concat(e);var r=document.getElementById("app-body");r.insertBefore(t,r.firstChild),setTimeout((function(){t.remove()}),5e3)}function z(e){var t=document.getElementById("run");t&&(e?(t.disabled=!0,t.innerHTML='<span class="ms-Button-label">Processing...</span>'):(t.disabled=!1,t.innerHTML='<span class="ms-Button-label">Run</span>'))}function B(){return B=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Run function started"),z(!0),e.prev=2,e.next=5,Excel.run(function(){var e=c(s().mark((function e(t){var r,n,o,a,i,c,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Excel.run started"),(r=t.workbook.getSelectedRange()).load("address"),r.load("values"),e.next=6,t.sync();case 6:if(console.log("Selected range:",r.address),n=r.values[0][0],console.log("Selected text:",n),n){e.next=11;break}throw new Error("No text selected in the range");case 11:return console.log("Starting structureDatabasequeries"),e.next=14,q(n);case 14:if(o=e.sent,console.log("Database queries completed"),o&&Array.isArray(o)){e.next=19;break}throw console.error("Invalid database results:",o),new Error("Failed to get valid database results");case 19:return a=o.map((function(e){return e?"Query: ".concat(e.query||"No query","\n")+"Training Data:\n".concat((e.trainingData||[]).join("\n"),"\n")+"Code Options:\n".concat((e.codeOptions||[]).join("\n"),"\n")+"Code Choosing Context:\n".concat((e.call1Context||[]).join("\n"),"\n")+"Code Editing Context:\n".concat((e.call2Context||[]).join("\n"),"\n")+"---\n":(console.error("Invalid result in dbResults:",e),"No results found")})).join("\n"),i="Client Request: ".concat(n,"\n\nDatabase Results:\n").concat(a),console.log("Enhanced prompt created"),console.log("Starting handleConversation"),e.next=25,_(i,!1);case 25:if(c=e.sent,console.log("Conversation completed"),c&&Array.isArray(c)){e.next=30;break}throw console.error("Invalid response:",c),new Error("Failed to get valid response from conversation");case 30:return console.log("Starting validation"),e.next=33,D();case 33:if(u=e.sent,console.log("Validation completed:",u),!u||!u.includes("Validation successful - no errors found")){e.next=39;break}l=c,e.next=44;break;case 39:return console.log("Starting validation correction"),e.next=42,F(n,c,u);case 42:l=e.sent,console.log("Validation correction completed");case 44:if(l&&Array.isArray(l)){e.next=47;break}throw console.error("Invalid final response:",l),new Error("Failed to get valid final response");case 47:return console.log("Writing response to Excel"),r.values=[[l.join("\n")]],e.next=51,t.sync();case 51:console.log("Response written to Excel");case 52:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error in run function:",e.t0),console.error("Error stack:",e.t0.stack),M(e.t0.message);case 12:return e.prev=12,z(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,7,12,15]])}))),B.apply(this,arguments)}Office.onReady((function(){console.log("Office.onReady called"),document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",function(){return l.apply(this,arguments)}().then((function(e){e?console.log("API keys initialized successfully"):(console.error("Failed to initialize API keys"),M("Failed to initialize API keys. Some features may not work correctly.")),w("test-prompt").then((function(e){console.log("Test prompt loaded:",e)})).catch((function(e){console.error("Error loading test prompt:",e)}))}));var e=document.getElementById("run");e?(e.onclick=function(){console.log("Run button clicked"),e.style.backgroundColor="#0078d4",setTimeout((function(){e.style.backgroundColor=""}),200),function(){B.apply(this,arguments)}()},console.log("Run button click handler attached")):console.error("Run button not found in DOM")}))}(),new URL(r(58394),r.b),new URL(r(98362),r.b)}();
//# sourceMappingURL=taskpane.js.map